<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>BloodBridge - Blood Donation System</title>
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}" type="image/x-icon">
</head>
<body>
    <!-- Top bar with emergency contact -->
    <div class="top-bar bg-light py-1">
        <div class="container d-flex justify-content-between align-items-center">
            <div>
                <small><i class="fas fa-phone-alt text-danger me-1"></i> Emergency: <strong>1-800-BLOOD-HELP</strong></small>
            </div>
            <div>
                <small><a href="{{ url_for('help_support') }}" class="text-decoration-none"><i class="fas fa-question-circle me-1"></i> Help</a></small>
            </div>
        </div>
    </div>

    <!-- Main navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="{{ url_for('index') }}">
                <svg class="blood-drop me-2" width="30" height="30" viewBox="0 0 40 40">
                    <path d="M20 2 C20 2 30 20 30 30 C30 35.5 25.5 40 20 40 C14.5 40 10 35.5 10 30 C10 20 20 2 20 2" fill="#dc3545"/>
                </svg>
                <span class="brand-text">BloodBridge</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('index') }}">Home</a>
                    </li>
                    {% if current_user.is_authenticated %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for(current_user.role + '_dashboard') }}">Dashboard</a>
                        </li>
                        {% if current_user.role == 'donor' %}
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('donate') }}">Donate Blood</a>
                            </li>
                        {% endif %}
                        {% if current_user.role == 'receiver' %}
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('request_blood') }}">Request Blood</a>
                            </li>
                        {% endif %}
                        {% if current_user.role == 'admin' %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('donation_programs.admin_programs') }}">
                                <i class="fas fa-calendar-alt"></i> Donation Programs
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('donation_programs.blood_inventory') }}">
                                <i class="fas fa-vial"></i> Blood Inventory
                            </a>
                        </li>
                        {% elif current_user.role == 'donor'%}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('donation_programs.list_programs') }}">
                                <i class="fas fa-calendar-alt"></i> Donation Programs
                            </a>
                        </li>
                        {% endif %}
                        
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('blood_requests') }}">Blood Requests</a>
                        </li>
                        
                    {% endif %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            Resources
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('donation_tips') }}">Donation Tips</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('eligibility_check') }}">Can I Give Blood?</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('blood_banks') }}">Blood Banks</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('faq') }}">FAQs</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="aboutDropdown" role="button" data-bs-toggle="dropdown">
                            About
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('teams') }}">Our Team</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('contact') }}">Contact Us</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('help_support') }}">Help & Support</a></li>
                        </ul>
                    </li>
                </ul>
                <div class="navbar-nav">
                    {% if current_user.is_authenticated %}
                        <div class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user-circle me-1"></i> {{ current_user.first_name }}
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><a class="dropdown-item" href="{{ url_for('profile') }}">My Profile</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{{ url_for('logout') }}">Logout</a></li>
                            </ul>
                        </div>
                    {% else %}
                        <a class="btn btn-outline-danger me-2" href="{{ url_for('login') }}">Login</a>
                        <a class="btn btn-danger" href="{{ url_for('register') }}">Register</a>
                    {% endif %}
                    {% if current_user.is_authenticated %}
                    <div class="nav-item dropdown me-3">
                        <a class="nav-link position-relative" href="#" id="notificationDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-bell"></i>
                            {% if unread_notifications %}
                                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                    {{ unread_notifications|length }}
                                </span>
                            {% endif %}
                        </a>
                        <div class="dropdown-menu dropdown-menu-end notification-dropdown" aria-labelledby="notificationDropdown">
                            <div class="dropdown-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">Notifications</h6>
                                {% if unread_notifications %}
                                    <button onclick="markAllNotificationsRead(event)" class="btn btn-link p-0 text-decoration-none small">Mark all read</button>
                                {% endif %}
                            </div>
                            <div class="notification-list" style="max-height: 300px; overflow-y: auto;">
                                {% if recent_notifications %}
                                    {% for notification in recent_notifications %}
                                        <a href="{{ notification.link or '#' }}" class="dropdown-item notification-item {% if not notification.is_read %}unread{% endif %} d-flex align-items-center p-2">
                                            <div class="notification-icon bg-{{ notification.type }} text-white me-3 p-2 rounded">
                                                {% if notification.type == 'success' %}
                                                    <i class="fas fa-check"></i>
                                                {% elif notification.type == 'warning' %}
                                                    <i class="fas fa-exclamation"></i>
                                                {% elif notification.type == 'danger' %}
                                                    <i class="fas fa-times"></i>
                                                {% else %}
                                                    <i class="fas fa-info"></i>
                                                {% endif %}
                                            </div>
                                            <div class="flex-grow-1">
                                                <h6 class="mb-1">{{ notification.title }}</h6>
                                                <p class="mb-0 small text-muted">{{ notification.message }}</p>
                                                <small class="text-muted">{{ notification.created_at|timeago }}</small>
                                            </div>
                                        </a>
                                    {% endfor %}
                                    {% if recent_notifications|length >= 5 %}
                                        <a href="{{ url_for('notifications') }}" class="dropdown-item text-center">
                                            View all notifications
                                        </a>
                                    {% endif %}
                                {% else %}
                                    <div class="dropdown-item text-center text-muted py-3">
                                        <i class="fas fa-bell-slash mb-2"></i>
                                        <p class="mb-0">No notifications</p>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <main class="container my-4">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category if category else 'info' }} alert-dismissible fade show">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>
<!-- Chatbot Container -->
<div id="chatbot-container" class="chatbot-container">
    <div class="chatbot-window" id="chatbot-window" style="display: none;">
        <div class="chatbot-header">
            <div class="chatbot-title">
                <i class="fas fa-robot me-2"></i>
                BloodBridge AI Assistant
            </div>
            <button id="close-chatbot" class="close-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="chatbot-messages" id="chatbot-messages">
            <div class="message bot welcome-message">
                <p>Welcome to BloodBridge AI Assistant! I'm here to help you with blood donation information.</p>
                <div class="quick-suggestions">
                    <button class="quick-suggestion">Donation Process</button>
                    <button class="quick-suggestion">donor register</button>
                    <button class="quick-suggestion">donation programs</button>
                </div>
            </div>
        </div>
        <div class="chatbot-input">
            <input 
                type="text" 
                id="chatbot-input"
                placeholder="Ask me about blood donation..."
            />
            <button id="send-message">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>
    <button id="toggle-chatbot" class="chatbot-toggle-btn">
        <i class="fas fa-comment-medical"></i>
        <span class="chatbot-badge" id="chatbot-new-message-badge" style="display: none;">1</span>
    </button>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const toggleBtn = document.getElementById('toggle-chatbot');
    const closeBtn = document.getElementById('close-chatbot');
    const chatbotWindow = document.getElementById('chatbot-window');
    const messagesContainer = document.getElementById('chatbot-messages');
    const inputField = document.getElementById('chatbot-input');
    const sendBtn = document.getElementById('send-message');
    const newMessageBadge = document.getElementById('chatbot-new-message-badge');

    // Expanded intents with comprehensive responses
    

    const expandedIntents = [
  {
    tag: 'greeting',
    patterns: [
      'hi', 'hello', 'hey', 'yo', 'sup', 'howdy', 'hey there', 'hi there', 'greetings', 'good day', 'good morning', 'good evening', 'hello there',
      'hiya', 'heya', 'helloo', 'hellooo', 'yo!', 'hi!', 'hello!', 'hey!', 'hey assistant', 'hi assistant', 'hey bot', 'hi bot', 'hi ai',
      'what’s up', 'what up', 'wassup', 'how are you', 'how r u', 'hw r u', 'anyone there?', 'u there?', 'bot are you there?', 'hello ai',
      'hey bro', 'hey dude', 'hey bloodbridge', 'hello bloodbridge', 'are you there', 'are you online', 'hey friend', 'yo bot', 'how is it going',
      'is anyone here', 'what’s happening', 'holla', 'aloha', 'bonjour', 'hola', 'namaste', 'salut', 'salaam', 'hiya buddy'
    ],
    responses: [
      'Hey there! How can I assist you with blood donation today?',
      'Hello! Need any help regarding blood donation?',
      'Hi! I’m here to help you with any questions about BloodBridge.',
      'Hi there! How can I support your donation journey today?',
      'Greetings! Ready to make a difference?'
    ]
  },
  {
    tag: 'goodbye',
    patterns: [
      'bye', 'see you later', 'goodbye', 'see ya', 'farewell', 'take care', 'bye bye', 'catch you later',
      'talk to you later', 'cya', 'gotta go', 'see you soon', 'I’m out', 'see you around', 'peace out', 'later bro', 'later dude', 'adios',
      'ciao', 'see you next time', 'thanks, bye', 'okay bye', 'bye now', 'I’ll go now', 'logging off', 'quitting', 'exiting', 'exit',
      'close', 'disconnect', 'end chat'
    ],
    responses: [
      'Goodbye! Feel free to reach out again.',
      'Take care! Donate blood, save lives.',
      'Bye! Let me know if you need anything else.',
      'Thanks for visiting BloodBridge. See you soon!'
    ]
  },
  {
    tag: 'thanks',
    patterns: [
      'thanks', 'thank you', 'thanks a lot', 'thanks so much', 'thx', 'thank u', 'ty', 'many thanks',
      'appreciate it', 'thanks a ton', 'thanks buddy', 'thank you so much', 'thank you very much',
      'I appreciate it', 'big thanks', 'I’m grateful', 'thanks a bunch', 'thaaaanks', 'thanks!!', 'thank you!',
      'cheers', 'bless you', 'thanks again'
    ],
    responses: [
      'You’re welcome!',
      'No problem at all.',
      'Glad I could help!',
      'Anytime! Let me know if you have more questions.',
      'Always happy to assist!'
    ]
  },
  {
    tag: 'noanswer',
    patterns: [],
    responses: [
      'I’m not sure how to respond to that. Try asking something about blood donation or our services.',
      'Sorry, I didn’t understand that. Could you rephrase?',
      'Hmm, I don’t have an answer for that. Ask me about blood donation, programs, or chat system.',
      'Can you please clarify your question?'
    ]
  },
  {
    tag: 'donor_register',
    patterns: [
      'donor register', 'I want to register as a donor', 'how do I become a donor', 'register me as a blood donor',
      'sign up to donate blood', 'donor registration', 'how to sign up as donor', 'become a donor',
      'donate blood registration', 'I want to donate blood', 'help me register as a donor',
      'start donating blood', 'I want to be a donor', 'how do I register to give blood', 'how to join as a donor'
    ],
    responses: [
      'To register as a donor, please visit the donor registration page and fill out your details.',
      'Great to hear you want to donate! Head to the donor signup section to get started.',
      'You can become a blood donor by completing the registration form on our site.',
      'Visit our Donor page and click on "Register" to start donating blood!'
    ]
  },
  {
    tag: 'receiver_register',
    patterns: [
      'I need blood', 'how can I receive blood', 'receiver registration', 'I want to register to get blood',
      'how to get blood', 'register as receiver', 'how do I ask for blood', 'blood request',
      'register to receive blood', 'I need a blood transfusion', 'get me blood', 'blood needed',
      'emergency blood', 'apply for blood', 'ask for blood'
    ],
    responses: [
      'To request blood, please register as a receiver on our platform.',
      'You can receive blood by filling out the receiver registration form.',
      'Head to our Receiver section and sign up to request blood.',
      'Please go to the receiver registration page to begin your request.'
    ]
  },
  
  {
    tag: 'donation_programs',
    patterns: [
      'donation programs', 'tell me about donation programs', 'what programs are there', 'blood donation events',
      'any campaigns going on', 'upcoming blood drives', 'current donation programs',
      'what are your donation events', 'is there a donation drive', 'blood camp info',
      'donation campaign details', 'available programs', 'program information',
      'do you have programs', 'which events are active'
    ],
    responses: [
      'Our donation programs include regular blood drives, awareness campaigns, and emergency donation calls.',
      'Visit our Donation Programs page to see current and upcoming events.',
      'We regularly organize donation drives—check our homepage for updates.',
      'You can view and join active donation campaigns through the Donation section.'
    ]
  },
  {
  tag: 'donation_process',
  patterns: [
    'how to donate', 'how do i donate', 'Donation Process', 'steps to donate',
    'how do i donate blood', 'how can i give blood', 'how can i donate blood',
    'process of donating blood', 'how blood donation works', 'donating blood steps',
    'what happens when you donate blood', 'blood donation process explained',
    'can you explain how to donate', 'guide to donating blood', 'step by step donation',
    'how does donating blood work', 'walk me through donation process',
    'i want to donate blood what should i do', 'what are the steps to donate blood',
    'what is the process of giving blood', 'procedure to donate blood', 'how blood donation is done',
    'explain the blood donation process', 'instructions to donate blood',
    'complete blood donation procedure', 'donation steps in detail',
    'i want to give blood what are the steps', 'donation method', 'donating instructions',
    'blood donation full process', 'how to begin blood donation',
    'how does the donation procedure work', 'can you tell me the donation process',
    'i want to understand the donation process', 'how do people donate blood',
    'what to do before donating', 'can you guide me through donating',
    'walk me through how to donate blood', 'how do you give blood', 'what should i do to donate blood',
    'how do i go about donating blood', 'where to start with blood donation',
    'can i donate blood and how', 'how can someone donate blood', 'how can i register to donate blood',
    'is there a process for donating blood', 'steps involved in giving blood',
    'please explain donation process', 'what is involved in donating blood',
    'can you walk me through blood donation', 'explain how donating blood works',
    'how do i start donating blood', 'what is the procedure to donate blood',
    'what do i do to donate blood', 'can you help me with blood donation process',
    'guide me on donating blood'
  ],
  responses: [
    'To donate blood, you must first create an account and submit your verification documents. Once the admin verifies your account, you can proceed to donate.',
    'The donation process starts with registration and document verification. After your account is approved by the admin, you can schedule and donate blood.',
    'Before donating, you need to submit important documents for verification. Once verified by the admin, you’ll go through screening, donation, and recovery.',
    'First step is verification: register and upload your ID and medical documents. Once approved by the admin, you can safely donate blood at a scheduled time.'
  ]
},

  {
    tag: 'eligibility',
    patterns: [
      'eligibility', 'am i eligible to donate', 'who can donate blood', 'donation eligibility',
      'can i donate blood', 'requirements to donate', 'criteria for blood donation',
      'eligibility to give blood', 'can anyone donate', 'rules for donation',
      'blood donation requirements', 'what are the eligibility criteria',
      'who is allowed to donate blood', 'can a person donate blood',
      'what is needed to donate blood', 'conditions for donating blood',
      'are there restrictions to donate', 'can i qualify to donate blood',
      'minimum requirements for blood donation', 'age limit for donating blood',
      'health conditions for donation', 'can i donate if i am sick',
      'can i donate blood if i have a disease', 'donation qualifications',
      'who cannot donate blood', 'eligibility criteria for blood donors',
      'who can be a donor', 'do i meet donation requirements',
      'can i donate now', 'can i donate if i have a cold',
      'can i donate if i took medicine', 'can i donate blood with anemia',
      'what disqualifies me from donating blood', 'can i donate blood with diabetes',
      'can i donate if i have high blood pressure'
    ],
    responses: [
      'You must be healthy, at least 18 years old, and meet weight requirements to donate blood.',
      'Eligibility includes being between 18-65 years, feeling well, and not having certain medical conditions.',
      'Please ensure you meet health criteria, including no recent illnesses or risky behaviors, before donating.',
      'Check the eligibility guidelines on our site for full details before donating.'
    ]
  },
  {
    tag: 'benefits',
    patterns: [
      'what are benefits of donating blood', 'why donate blood', 'advantages of blood donation',
      'why should i donate blood', 'blood donation benefits', 'how does blood donation help',
      'good reasons to donate blood', 'is donating blood beneficial', 'health benefits of blood donation',
      'benefits for donor', 'does donating blood help health',
      'how does donating blood benefit me', 'what good comes from donating blood',
      'benefits after donating blood', 'blood donation advantages',
      'how is donating blood helpful', 'positive effects of blood donation',
      'why is blood donation important', 'reasons to donate blood',
      'can donating blood improve health', 'can i benefit from donating blood',
      'does blood donation improve health', 'advantages to donating blood',
      'why blood donation is good', 'how does giving blood help',
      'does donating blood help society', 'how does blood donation save lives'
    ],
    responses: [
      'Donating blood helps save lives and can improve your health by stimulating blood cell production.',
      'You get the satisfaction of saving lives, and your body benefits from the renewal process after donation.',
      'Regular blood donation supports your cardiovascular health and reduces harmful iron levels.',
      'Blood donation is a selfless act that contributes to community health and may lower your risk of certain diseases.'
    ]
  },
  {
    tag: 'frequency',
    patterns: [
      'how often can i donate blood', 'donation frequency', 'how frequently to donate',
      'how many times can i donate', 'can i donate every month', 'how often is donation allowed',
      'blood donation intervals', 'when can i donate again', 'donate blood often',
      'how many donations per year', 'frequency of blood donation',
      'how soon can i donate again', 'how many times in a year can i donate',
      'how much time between donations', 'time gap between donations',
      'what is donation frequency', 'how often to give blood',
      'how frequently can someone donate blood', 'donation limits',
      'minimum gap between donations', 'maximum number of donations per year'
    ],
    responses: [
      'You can donate whole blood every 8 weeks (56 days). Other types may have different intervals.',
      'Typically, donors can give blood up to 6 times a year, depending on health and blood type.',
      'It is recommended to wait at least 8 weeks between whole blood donations.',
      'Please follow guidelines and wait the specified period before donating again to keep safe.'
    ]
  },
  {
    tag: 'aftercare',
    patterns: [
      'what to do after donating blood', 'post donation care', 'after donating blood',
      'care after blood donation', 'how to recover after donation', 'what happens after donating',
      'blood donation recovery', 'after blood donation instructions', 'tips after donation',
      'care tips post donation', 'how to feel better after donating',
      'what to expect after donation', 'blood donation side effects', 'recovering from donation',
      'after donation advice', 'how to take care after donating blood'
    ],
    responses: [
      'After donating, rest for 10-15 minutes and drink plenty of fluids.',
      'Avoid heavy exercise for the rest of the day and eat a healthy meal.',
      'If you feel dizzy, sit down and raise your feet. Inform staff if you feel unwell.',
      'Take it easy for the day, and keep the bandage on for a few hours.'
    ]
  },
  {
    tag: 'donation_locations',
    patterns: [
      'where can i donate blood', 'blood donation centers', 'donation locations',
      'nearest blood bank', 'blood donation places near me', 'where to donate blood',
      'donation sites', 'blood banks nearby', 'donation camps near me',
      'where are donation centers', 'how to find blood donation place',
      'locations to donate blood', 'nearest donation center'
    ],
    responses: [
      'You can find donation centers on our Locations page or by using the map on our site.',
      'Visit local hospitals and blood banks to donate blood.',
      'We regularly organize donation camps in many cities—check our events page for updates.',
      'Use the search feature on our site to find the nearest donation location.'
    ]
  },
  {
    tag: 'donation_eligibility_conditions',
    patterns: [
      'what conditions affect eligibility', 'who cannot donate blood',
      'disqualifications for donation', 'conditions preventing donation',
      'health issues that stop donation', 'when not to donate blood',
      'medical reasons to avoid donation', 'can i donate if sick',
      'illnesses that disqualify donors', 'health problems stopping donation',
      'when am i not eligible to donate'
    ],
    responses: [
      'Certain illnesses, recent surgeries, and risky behaviors may make you ineligible to donate.',
      'If you have certain infections, recent travel history, or chronic conditions, you may not qualify.',
      'Please consult with our staff or your doctor to confirm eligibility before donating.',
      'Review the full eligibility list on our website to ensure you qualify.'
    ]
  },
  {
    tag: 'blood_types',
    patterns: [
      'what are blood types', 'blood group types', 'different blood types',
      'explain blood types', 'types of blood', 'blood classification',
      'how many blood types are there', 'which blood type is universal donor',
      'what blood types can donate to me', 'blood compatibility'
    ],
    responses: [
      'There are four main blood types: A, B, AB, and O, each can be positive or negative.',
      'Type O negative is the universal donor type.',
      'Blood type compatibility is important for safe transfusions.',
      'You can learn more about blood types on our educational page.'
    ]
  },
  {
    tag: 'blood_donation_facts',
    patterns: [
      'interesting facts about blood donation', 'blood donation facts',
      'did you know about blood donation', 'facts about donating blood',
      'important blood donation information'
    ],
    responses: [
      'Did you know one donation can save up to three lives?',
      'Blood cannot be manufactured; donation is the only source.',
      'Only about 3% of eligible donors give blood yearly.',
      'Blood donation is safe and takes about 10 minutes.'
    ]
  },
  {
    tag: 'donor_rights',
    patterns: [
      'what are donor rights', 'rights of blood donors', 'donor protections',
      'what can donors expect', 'donor privacy', 'donor safety',
      'how are donors protected', 'rights during donation'
    ],
    responses: [
      'Donors have the right to privacy, informed consent, and safe donation procedures.',
      'Your health information is confidential and protected.',
      'You can ask questions and withdraw consent at any time.',
      'Our staff ensures a safe and comfortable donation experience.'
    ]
  },

  {
  tag: 'system_guide',
  patterns: [
    'where do i donate blood in this app',
    'how to donate blood in this system',
    'guide me to donate blood here',
    'how do i use this app to donate',
    'what steps to donate blood using this app',
    'help me donate blood in app',
    'where is the donation section',
    'how do i find donation centers in this app'
  ],
  responses: [
    'To donate blood using this app, please go to the "Donation Centers" section from the main menu, select a nearby center, and follow the registration steps.',
    'You can donate blood by navigating to the "Donation Centers" page, choosing a location, and booking your appointment through the app.',
    'Use the "Donation Centers" tab on the main screen to find locations and register for blood donation.',
    'Start by clicking on "Donation Centers" in the app menu to find where you can donate blood near you.'
  ]
},

{
      "tag": "donation_start",
      "patterns": [
        "What should I do first?",
        "How will I be able to donate blood from this system?",
        "How do I start donating?",
        "What's the first step to donate?",
        "How can I donate blood?"
      ],
      "responses": [
        "Firstly, authenticate your ID and verify that you are a donor. Then proceed to donate blood."
      ]
    },

    {
  "tag": "eligibility_criteria",
  "patterns": [
    "am i eligible to donate blood", "who can donate blood", "can i donate blood",
    "blood donation requirements", "eligibility for blood donation",
    "what are the conditions to donate blood", "criteria to donate blood",
    "who is allowed to donate blood", "what makes you eligible to donate",
    "blood donation age limit", "health requirements for donating blood"
  ],
  "responses": [
    "To donate blood, you generally must be between 18 and 65 years old, weigh at least 50 kg, and be in good health.",
    "You must not be suffering from any infectious diseases, and recent surgeries or tattoos may disqualify you temporarily.",
    "Donors must meet age, weight, and health conditions. If unsure, consult with our team before registering.",
    "If you're healthy, over 18, and meet the medical criteria, you're likely eligible to donate blood."
  ]
},

{
  "tag": "document_requirements",
  "patterns": [
    "what documents are needed", "what should I upload", "required documents for donation",
    "which documents do I need to donate", "documents to verify account", "ID for blood donation",
    "upload verification documents", "what proof is needed", "what kind of documents are required",
    "how to verify account", "what documents are needed to get verified"
  ],
  "responses": [
    "You need to upload a valid government-issued ID (like Aadhaar or Passport) and a recent medical certificate or blood report.",
    "Required documents include a photo ID and any supporting medical document verifying you're fit to donate.",
    "Please upload a valid ID and any health-related documentation. The admin will review and approve your account for donation.",
    "For verification, we require your identification and medical documents to ensure donor safety and eligibility."
  ]
},

{
  "tag": "account_verification_status",
  "patterns": [
    "is my account verified", "has my account been approved", "how do I know if I'm verified",
    "how to check verification status", "was my verification accepted", "did the admin approve me",
    "how do I check my donor verification", "status of my documents", "am i approved to donate"
  ],
  "responses": [
    "You can check your account status by logging in and visiting your dashboard. If verified, it will show 'Approved'.",
    "If your documents are approved by the admin, your status will update to 'Verified'. You'll also receive a confirmation.",
    "Log in and go to your profile to see your current verification status. If pending or rejected, follow the instructions shown.",
    "You will be notified by email or dashboard alert once the admin reviews and updates your verification."
  ]
},

{
  "tag": "reasons_for_rejection",
  "patterns": [
    "why was my account rejected", "my verification failed", "why can't I donate",
    "reason for rejection", "admin rejected my application", "my documents were not approved",
    "what to do if account is rejected", "i was rejected", "my donor status is rejected"
  ],
  "responses": [
    "Your account may be rejected due to missing or unclear documents, health concerns, or age/weight issues.",
    "Please ensure your documents are valid, readable, and recent. You can re-upload them for re-evaluation.",
    "Rejection could occur if health criteria aren’t met or if documents are invalid. Contact support for clarification.",
    "You can review the rejection message in your profile or reach out to the admin for specific feedback."
  ]
},

{
  "tag": "re_donate_time",
  "patterns": [
    "when can I donate again", "how often can I give blood", "how long to wait before next donation",
    "how many times can I donate", "interval between blood donations", "how frequently can I donate",
    "next donation date", "time gap between donations", "how soon can I donate again"
  ],
  "responses": [
    "You should wait at least 56 days (8 weeks) between whole blood donations.",
    "Male donors can usually donate every 3 months, and female donors every 4 months depending on health.",
    "It’s important to allow your body time to recover, so the recommended wait time is 8 weeks.",
    "You can check your last donation date in your profile to calculate when you're next eligible to donate."
  ]
}







    

];






    function findBestMatch(userMessage) {
        const lowercaseMessage = userMessage.toLowerCase();
        
        // Find best matching intent
        const matches = expandedIntents.filter(intent => 
            intent.patterns.some(pattern => 
                lowercaseMessage.includes(pattern.toLowerCase())
            )
        );

        // Return a random response from the best match
        if (matches.length > 0) {
            const bestMatch = matches[0];
            return bestMatch.responses[Math.floor(Math.random() * bestMatch.responses.length)];
        }

        // Fallback responses for unknown queries
        const fallbackResponses = [
            'I\'m not sure I completely understand. Could you rephrase that?',
            'That\'s an interesting question. Could you provide more context about blood donation?',
            'I can help with questions about blood donation. Could you be more specific?'
        ];

        return fallbackResponses[Math.floor(Math.random() * fallbackResponses.length)];
    }

    function addMessage(text, sender) {
        const messageEl = document.createElement('div');
        messageEl.classList.add('message', sender);
        messageEl.textContent = text;
        
        messagesContainer.appendChild(messageEl);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;

        // Show new message badge when chatbot is closed
        if (chatbotWindow.style.display === 'none' && sender === 'bot') {
            newMessageBadge.style.display = 'block';
        }
    }

    function sendMessage() {
        const message = inputField.value.trim();
        if (!message) return;

        // Add user message
        addMessage(message, 'user');
        
        // Generate bot response
        const botResponse = findBestMatch(message);
        
        // Clear input
        inputField.value = '';
        
        // Add bot response with a slight delay
        setTimeout(() => {
            addMessage(botResponse, 'bot');
        }, 500);
    }

    // Quick suggestion buttons
    document.querySelectorAll('.quick-suggestion').forEach(btn => {
        btn.addEventListener('click', () => {
            inputField.value = btn.textContent;
            sendMessage();
        });
    });

    // Toggle chatbot visibility
    toggleBtn.addEventListener('click', () => {
        chatbotWindow.style.display = 'flex';
        toggleBtn.style.display = 'none';
        newMessageBadge.style.display = 'none';
    });

    // Close chatbot
    closeBtn.addEventListener('click', () => {
        chatbotWindow.style.display = 'none';
        toggleBtn.style.display = 'block';
    });

    // Send message on button click
    sendBtn.addEventListener('click', sendMessage);

    // Send message on Enter key press
    inputField.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });
});
</script>
    <footer class="footer py-4 bg-light mt-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-3">
                    <h5 class="text-danger">BloodBridge</h5>
                    <p class="text-muted">Connecting donors and recipients to save lives through blood donation.</p>
                    <div class="social-icons">
                        <a href="#" class="text-danger me-2"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-danger me-2"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-danger me-2"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="text-danger"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                <div class="col-lg-2 col-md-4 mb-3">
                    <h6 class="text-uppercase fw-bold mb-3">Quick Links</h6>
                    <ul class="list-unstyled">
                        <li><a href="{{ url_for('index') }}" class="text-decoration-none text-muted">Home</a></li>
                        <li><a href="{{ url_for('donation_tips') }}" class="text-decoration-none text-muted">Donation Tips</a></li>
                        <li><a href="{{ url_for('eligibility_check') }}" class="text-decoration-none text-muted">Eligibility</a></li>
                        <li><a href="{{ url_for('faq') }}" class="text-decoration-none text-muted">FAQs</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-md-4 mb-3">
                    <h6 class="text-uppercase fw-bold mb-3">About</h6>
                    <ul class="list-unstyled">
                        <li><a href="{{ url_for('teams') }}" class="text-decoration-none text-muted">Our Team</a></li>
                        <li><a href="{{ url_for('blood_banks') }}" class="text-decoration-none text-muted">Blood Banks</a></li>
                        <li><a href="{{ url_for('contact') }}" class="text-decoration-none text-muted">Contact Us</a></li>
                        <li><a href="{{ url_for('help_support') }}" class="text-decoration-none text-muted">Help & Support</a></li>
                    </ul>
                </div>
                <div class="col-lg-4 col-md-4">
                    <h6 class="text-uppercase fw-bold mb-3">Contact</h6>
                    <p class="text-muted">
                        <i class="fas fa-map-marker-alt text-danger me-2"></i> 123 Health Street, Medical District
                    </p>
                    <p class="text-muted">
                        <i class="fas fa-phone text-danger me-2"></i> 1-800-BLOOD-HELP
                    </p>
                    <p class="text-muted">
                        <i class="fas fa-envelope text-danger me-2"></i> info@bloodbridge.com
                    </p>
                </div>
            </div>
            <hr>
            <div class="row">
                <div class="col-md-6 text-md-start text-center">
                    <small class="text-muted">&copy; 2024 BloodBridge. All rights reserved.</small>
                </div>
                <div class="col-md-6 text-md-end text-center">
                    <small class="text-muted">
                        <a href="#" class="text-decoration-none text-muted me-3">Privacy Policy</a>
                        <a href="#" class="text-decoration-none text-muted">Terms of Service</a>
                    </small>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    {% block extra_scripts %}{% endblock %}
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="notificationToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i class="fas fa-bell text-danger me-2"></i>
                <strong class="me-auto" id="toastTitle"></strong>
                <small id="toastTime">just now</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage"></div>
        </div>
    </div>
    
    <script>
    // Function to show a notification toast
    function showNotificationToast(title, message, type = 'info') {
        const toast = document.getElementById('notificationToast');
        const toastTitle = document.getElementById('toastTitle');
        const toastMessage = document.getElementById('toastMessage');
        
        // Set content
        toastTitle.textContent = title;
        toastMessage.textContent = message;
        
        // Remove existing color classes and add new one
        toast.className = 'toast';
        toast.classList.add('bg-light');
        toast.classList.add('border-' + type);
        
        // Show the toast
        const bsToast = new bootstrap.Toast(toast);
        bsToast.show();
    }
    
    // Function to update notification badge
    function updateNotificationBadge(count) {
        const dropdown = document.getElementById('notificationDropdown');
        if (!dropdown) return;
        
        let badge = dropdown.querySelector('.badge');
        
        if (count > 0) {
            if (!badge) {
                badge = document.createElement('span');
                badge.className = 'position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger notification-badge-new';
                dropdown.appendChild(badge);
            }
            badge.textContent = count;
        } else if (badge) {
            badge.remove();
        }
    }
    
    // Example usage: Show a notification when a new blood request matches
    // showNotificationToast('Blood Request Match', 'A new blood request matches your blood type!', 'danger');

    // Handle mark all notifications read
    function markAllNotificationsRead(event) {
        event.preventDefault();
        
        fetch('{{ url_for("mark_all_read") }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token() }}'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Remove unread styling from all notifications
                document.querySelectorAll('.notification-item.unread').forEach(item => {
                    item.classList.remove('unread');
                });
                
                // Update/remove notification badge
                const badge = document.querySelector('#notificationDropdown .badge');
                if (badge) {
                    badge.remove();
                }
                
                // Hide the mark all read button
                event.target.style.display = 'none';
            }
        })
        .catch(error => console.error('Error:', error));
    }
    </script>
</body>
</html>
